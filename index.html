<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV On The Go</title>
</head>
<body>
    <div class="container">
        <h1>EV On The Go</h1>
        <label for="location">Enter a location: </label>
        <input type="text" id="location">
        <button type="button" onClick="getLocationName();">Click for location</button>
    </div>
    <div id="myTable">

    </div>

    <script>

     // API fetch link GEOCODE examle:  https://api.tomtom.com/search/2/geocode/ulbeek.json?key=dnA4PR9uKOU3Ltk0V7Fb8A5t6vHnsguc
        
    // API fetch link CATEGORY SEARCH example: https://api.tomtom.com/search/2/categorySearch/electric%20vehicle%20station.json?limit=100&lat=37.337&lon=-121.89&key=dnA4PR9uKOU3Ltk0V7Fb8A5t6vHnsguc

        // =============== API PARAMETERS AND KEY =======================

        const key = "dnA4PR9uKOU3Ltk0V7Fb8A5t6vHnsguc"; // API Key
        const category = "electric%20vehicle%20station"; // filter for all electric vehicle stations used in api
        const limit = 100;  // limit is the amount of search results

        // ================= GET Latidude and Longitude bases on address text input =================

        function getLocationName() {
            const location = document.getElementById("location");
            fetchGeoLocation(location.value);
        };
        
        async function fetchGeoLocation(location) {
            try {
                const response = await fetch("https://api.tomtom.com/search/2/geocode/" + location + ".json?key=" + key);
                const data = await response.json();
                const lat = data.results[0].position.lat;
                const lon = data.results[0].position.lon;
                fetchEvStation(lat, lon);
            }
            catch(error) {
                console.log(error);
            }
        }

        // ============== GET Electrice Vehicle Station locations bases on the latitude and longitude values

        async function fetchEvStation(lat, lon) {
            try {
                const response = await fetch("https://api.tomtom.com/search/2/categorySearch/" + category + ".json?limit=" + limit + "&lat=" + lat + "&lon=" + lon + "&key=" + key);
                const data = await response.json(); 
                console.log(data)
                putData(data);
            }
            catch(error) {
                console.log(error)
            }
        }


        // ============= Putting API data into HTML table =====================

        const putData = data => {
            let table = `
            <table border="1">
                <tr>
                    <th>Name</th>
                    <th>Address</th>
                </tr>
            `;
            for (let result of data.results) {
                table += `
                <tr>
                    <td>${result.poi.name}</td>
                    <td>${result.address.freeformAddress}</td>
                </tr>
                `
            }
            table += `
            </table>
            `

            document.getElementById("myTable").innerHTML = table;
        }
        
    </script>
</body>
</html>